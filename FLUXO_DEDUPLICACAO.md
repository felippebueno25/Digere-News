# Diagrama da SoluÃ§Ã£o de DeduplicaÃ§Ã£o

## Fluxo de ExecuÃ§Ã£o (v8.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INÃCIO DA EXECUÃ‡ÃƒO                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  load_history()              â”‚
        â”‚  Carrega .news_history.json  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ clean_old_history()          â”‚
        â”‚ Remove notÃ­cias > 7 dias     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        [HistÃ³rico em memÃ³ria: 8 notÃ­cias]
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Iterar sobre RSS (20 max)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Para cada entrada RSS     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  resolve_url_ddg()           â”‚
        â”‚  Encontra URL real           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ URL encontrada?     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   NÃƒO    â”‚   SIM    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  SIM: continue  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  get_news_hash(title, url)   â”‚
        â”‚  Cria MD5 Ãºnico              â”‚
        â”‚  Ex: a1b2c3d4...             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ is_news_duplicate()?         â”‚
        â”‚ Hash jÃ¡ estÃ¡ no histÃ³rico?   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
           â”‚ SIM   â”‚     â”‚   NÃƒO    â”‚
           â””â”€â”€â”€â”€â”€â”¬â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚ ğŸ”´ DUPLICATA    â”‚  â”‚
        â”‚ Incrementa      â”‚  â”‚
        â”‚ duplicates++    â”‚  â”‚
        â”‚ Pula (continue) â”‚  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                             â”‚
                             â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ âœ… NOTÃCIA NOVA              â”‚
                â”‚ extract_content_robust()    â”‚
                â”‚ Baixa e extrai conteÃºdo     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Adiciona ao news_buffer      â”‚
                â”‚ - title                      â”‚
                â”‚ - url                        â”‚
                â”‚ - content                    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ time.sleep(2)                â”‚
                â”‚ Evita rate-limiting          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ count++                      â”‚
                â”‚ if count >= MAX_ITEMS: break â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                   [Fim do loop]
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  news_buffer.length > 0?     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚
           â”Œâ”€â”€â”€â”€â”€â–¼â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
           â”‚ SIM   â”‚     â”‚   NÃƒO    â”‚
           â””â”€â”€â”€â”€â”€â”¬â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                 â”‚           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Processa      â”‚   â”‚ âš ï¸ Nenhuma       â”‚
    â”‚ notÃ­cias      â”‚   â”‚ notÃ­cia nova     â”‚
    â”‚               â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ generate_     â”‚          â”‚
    â”‚ final_report()â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
             â”‚                 â”‚
             â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ ATUALIZAR HISTÃ“RICO    â”‚ â”‚
    â”‚ Para cada notÃ­cia:     â”‚ â”‚
    â”‚ history[hash] = {      â”‚ â”‚
    â”‚   title, url,          â”‚ â”‚
    â”‚   timestamp            â”‚ â”‚
    â”‚ }                      â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚                 â”‚
             â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ save_history()         â”‚ â”‚
    â”‚ Persiste em JSON       â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚                 â”‚
             â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ send_telegram()        â”‚ â”‚
    â”‚ Envia briefing         â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚                 â”‚
             â–¼                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ âœ… Sucesso!            â”‚ â”‚
    â”‚ (Fim)                  â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                               â”‚
                               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ âš ï¸ (Fim)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Estrutura do `.news_history.json`

```json
{
  "hash_md5_1": {
    "title": "Lula assina novo decreto sobre reforma tributÃ¡ria",
    "url": "https://g1.globo.com/politica/noticia/...",
    "timestamp": "2026-01-07T15:30:00"
  },
  
  "hash_md5_2": {
    "title": "BC aumenta taxa Selic para 11,5% a.a.",
    "url": "https://www.bcb.gov.br/...",
    "timestamp": "2026-01-07T12:15:00"
  },
  
  "hash_md5_3": {
    "title": "Mercado financeiro fecha em alta",
    "url": "https://www1.folha.uol.com.br/...",
    "timestamp": "2026-01-06T21:45:00"
  }
}
```

## ComparaÃ§Ã£o de Comportamento

### VersÃ£o 7.1 (Antes - SEM DEDUPLICAÃ‡ÃƒO)

```
ExecuÃ§Ã£o 08:00
â”œâ”€ NotÃ­cia A â†’ Processa â†’ Telegram
â”œâ”€ NotÃ­cia B â†’ Processa â†’ Telegram
â”œâ”€ NotÃ­cia C â†’ Processa â†’ Telegram
â””â”€ (3 notÃ­cias enviadas)

ExecuÃ§Ã£o 12:00 (RSS nÃ£o atualizou 100%)
â”œâ”€ NotÃ­cia A â†’ Processa â†’ Telegram â† âŒ DUPLICATA!
â”œâ”€ NotÃ­cia B â†’ Processa â†’ Telegram â† âŒ DUPLICATA!
â”œâ”€ NotÃ­cia C â†’ Processa â†’ Telegram â† âŒ DUPLICATA!
â”œâ”€ NotÃ­cia D â†’ Processa â†’ Telegram
â””â”€ (4 notÃ­cias enviadas, 3 sÃ£o spam)

Problema: UsuÃ¡rio recebe a mesma notÃ­cia 2x
```

### VersÃ£o 8.0 (Depois - COM DEDUPLICAÃ‡ÃƒO)

```
ExecuÃ§Ã£o 08:00
â”œâ”€ NotÃ­cia A â†’ âœ… Nova â†’ Processa â†’ Telegram
â”œâ”€ NotÃ­cia B â†’ âœ… Nova â†’ Processa â†’ Telegram
â”œâ”€ NotÃ­cia C â†’ âœ… Nova â†’ Processa â†’ Telegram
â”œâ”€ HistÃ³rico: [A, B, C]
â””â”€ (3 notÃ­cias enviadas)

ExecuÃ§Ã£o 12:00 (RSS nÃ£o atualizou 100%)
â”œâ”€ NotÃ­cia A â†’ âŒ Duplicata (no histÃ³rico) â†’ Pula
â”œâ”€ NotÃ­cia B â†’ âŒ Duplicata (no histÃ³rico) â†’ Pula
â”œâ”€ NotÃ­cia C â†’ âŒ Duplicata (no histÃ³rico) â†’ Pula
â”œâ”€ NotÃ­cia D â†’ âœ… Nova â†’ Processa â†’ Telegram
â”œâ”€ HistÃ³rico: [A, B, C, D]
â””â”€ (1 notÃ­cia enviada, zero spam!)

BenefÃ­cio: UsuÃ¡rio recebe APENAS notÃ­cias novas
```

## Hash MD5 - Como Funciona

```
Entrada:
  title = "Lula assina decreto"
  url = "https://g1.globo.com/noticia-123"

NormalizaÃ§Ã£o:
  title.lower() = "lula assina decreto"
  url.lower() = "https://g1.globo.com/noticia-123"
  
ConcatenaÃ§Ã£o com separador:
  key = "lula assina decreto|https://g1.globo.com/noticia-123"

MD5:
  hash = MD5(key) = "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"

VerificaÃ§Ã£o:
  if "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6" in history:
    â†’ Ã‰ duplicata!
  else:
    â†’ Ã‰ notÃ­cia nova!
```

## Limpeza AutomÃ¡tica

```
HistÃ³rico com 7 dias de janela:

Dia 1:  [NotÃ­cia A, B, C]
Dia 2:  [A, B, C, D, E]
Dia 3:  [A, B, C, D, E, F]
Dia 4:  [A, B, C, D, E, F, G]
Dia 5:  [A, B, C, D, E, F, G, H]
Dia 6:  [A, B, C, D, E, F, G, H, I]
Dia 7:  [A, B, C, D, E, F, G, H, I, J]
Dia 8:  [B, C, D, E, F, G, H, I, J, K]  â† A removida (> 7 dias)
Dia 9:  [C, D, E, F, G, H, I, J, K, L]  â† B removida
```

